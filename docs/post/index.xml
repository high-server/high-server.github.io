<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Posts on 架构技术漫谈</title>
    <link>https://high-server.github.io/post/</link>
    <description>Recent content in Posts on 架构技术漫谈</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Sat, 03 Jul 2021 15:01:55 +0800</lastBuildDate><atom:link href="https://high-server.github.io/post/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>实战CGO</title>
      <link>https://high-server.github.io/post/arch/cgo/</link>
      <pubDate>Sat, 03 Jul 2021 15:01:55 +0800</pubDate>
      
      <guid>https://high-server.github.io/post/arch/cgo/</guid>
      <description>某项目要集成 PDF 文件的 OCR 功能，不过由于此功能技术难度太大，网络上找不到靠谱的开源实现，最终不得不选择 ABBYY FineReader Engine 的付费服务。可惜 ABBYY 只提供了 C++ 和 Java 两种编程语言的 SDK，而我们的项目采用的编程语言是 Golang，此时通常的集成方法是使用 C++ 或 Java 实现一个服务，然后在 Golang 项目里通过 RPC 调用服务，不过如此一来明显增加了系统的复杂度，好在 Golang 支持 CGO，让我们可以很方便的在 Golang 中使用 C 模块，本文总结了我在学习 CGO 过程中的心得体会。
Hello World 让我们看看一个 CGO 版本的 Hello, world 大概长什么样：
package main /* #include &amp;lt;stdio.h&amp;gt; void say(const char *s) { puts(s); } */ import &amp;#34;C&amp;#34; func main() { hello() } func hello() { s := C.CString(&amp;#34;Hello, World\n&amp;#34;) C.say(s) } 如上所示，通过「import “C”」来激活 CGO，并且所有 C 语言相关的代码都以注释的形式放在此行之上，中间不允许有空行，这样我们就可以在 Golang 代码里使用 C 模块了，看上去很简单，不过代码里存在内存泄漏，让我们修改一下代码，使问题更明显一点：</description>
    </item>
    
    <item>
      <title>从iptables谈ServiceMesh流量拦截</title>
      <link>https://high-server.github.io/post/arch/iptables/</link>
      <pubDate>Thu, 10 Jun 2021 14:38:48 +0800</pubDate>
      
      <guid>https://high-server.github.io/post/arch/iptables/</guid>
      <description>&lt;p&gt;最近研究学习 Kubernetes 和 ServiceMesh 过程中都看到了 &lt;strong&gt;iptables&lt;/strong&gt; 发挥重要作用独挡一面的场景。  &lt;br&gt;
Kubernetes 中 iptables 作为 kube-proxy 里控制流量转发的核心模式，通过在目标 node 的 iptables 中增加一些自定义链对流经到该 node 的数据包做DNAT和SNAT操作以实现路由、负载均衡和地址转换。  &lt;br&gt;
ServiceMesh 服务网格中 Istio 通过 init 容器（启动命令为istio-iptables）给 Sidecar 容器即 Envoy 代理做初始化，设置 iptables 端口转发，从而实现流量劫持&amp;amp;转发控制等服务治理相关。&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>浅谈pprof</title>
      <link>https://high-server.github.io/post/arch/pprof/</link>
      <pubDate>Sun, 06 Jun 2021 15:45:29 +0800</pubDate>
      
      <guid>https://high-server.github.io/post/arch/pprof/</guid>
      <description>&lt;p&gt;对于大多数 Gopher 而言，一般平时最主要的工作内容除了实现各种无聊的业务逻辑之外，剩下的就是解决各种琐碎的问题。比如：查询性能瓶颈在哪里？查询内存泄漏在哪里？好在 pprof 是处理此类问题的利器，共有两套标准库，分别适用于不同的场景：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://golang.org/pkg/runtime/pprof/&#34;&gt;runtime/pprof&lt;/a&gt;：采集工具型应用运行数据进行分析&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://golang.org/pkg/net/http/pprof/&#34;&gt;net/http/pprof&lt;/a&gt;：采集服务型应用运行时数据进行分析&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;命令行工具「go test」就包含了 runtime/pprof，相关参数请参考「go help testflag」：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;shell&amp;gt; go test -cpuprofile cpu.out -memprofile mem.out -bench .
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;不过和 runtime/pprof 相比，更常用的是 net/http/pprof，接下来我们主要通过它来解决一些常见问题，想要激活 net/http/pprof 的话很简单，只要导入对应的包并启动服务即可：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;import _ &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;net/http/pprof&amp;#34;&lt;/span&gt;

func main&lt;span style=&#34;color:#f92672&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;{&lt;/span&gt;
	_ &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; http.ListenAndServe&lt;span style=&#34;color:#f92672&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;localhost:6060&amp;#34;&lt;/span&gt;, nil&lt;span style=&#34;color:#f92672&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color:#f92672&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;需要注意的是，千万别让外网访问到 pprof，否则可能会导致出现安全问题。有兴趣的读者可以尝试通过 google 搜索「intitle:/debug/pprof/ inurl:/debug/pprof/」看看反面例子。&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>Golang 函数和 C 函数深度对比</title>
      <link>https://high-server.github.io/post/inside-golang/function/</link>
      <pubDate>Wed, 26 May 2021 17:25:49 +0800</pubDate>
      
      <guid>https://high-server.github.io/post/inside-golang/function/</guid>
      <description>&lt;p&gt;无论是什么语言，函数都是最常被使用到的东西。&lt;/p&gt;
&lt;p&gt;我们对比一下 Golang 和 C 这两种语言的函数实现，进而我们能真正理解以下两个问题。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;为什么 C 语言只能有一个返回值，而 Golang 中可以返回多个？&lt;/li&gt;
&lt;li&gt;Golang 函数调用在性能上和 C 比有何差异？&lt;/li&gt;
&lt;/ul&gt;</description>
    </item>
    
    <item>
      <title>我的应用程序新招了个全能的小秘书</title>
      <link>https://high-server.github.io/post/arch/k8s-deploy/</link>
      <pubDate>Tue, 25 May 2021 15:31:27 +0800</pubDate>
      
      <guid>https://high-server.github.io/post/arch/k8s-deploy/</guid>
      <description>&lt;p&gt;近一年，我的应用程序因为贴近用户需求被推上了热搜 😁 ，不过他也随之变得异常忙碌。来感受下老板和开发童鞋们的吐槽吧~~&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>你真的理解容器吗？</title>
      <link>https://high-server.github.io/post/arch/container/</link>
      <pubDate>Tue, 25 May 2021 11:03:14 +0800</pubDate>
      
      <guid>https://high-server.github.io/post/arch/container/</guid>
      <description>&lt;p&gt;提到“容器”，大家应该都不陌生，不是什么特别新鲜的技术了，受众也越来越广了，但是会用就真的理解吗？以下几个相关问题你真的能做到了然于胸吗？&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;“容器”是怎么把自己隔离开的呐？&lt;/li&gt;
&lt;li&gt;“容器”能使用宿主机的全部资源吗？&lt;/li&gt;
&lt;li&gt;“容器”有自己的文件系统吗？&lt;/li&gt;
&lt;li&gt;“容器”与虚拟机有什么区别？&lt;/li&gt;
&lt;/ol&gt;</description>
    </item>
    
    <item>
      <title>浅谈NATS消息系统</title>
      <link>https://high-server.github.io/post/arch/nats/</link>
      <pubDate>Mon, 24 May 2021 10:28:44 +0800</pubDate>
      
      <guid>https://high-server.github.io/post/arch/nats/</guid>
      <description>&lt;p&gt;我用过很多消息系统，比如：简单的 &lt;a href=&#34;https://redis.io/topics/streams-intro&#34;&gt;Redis Streams&lt;/a&gt;；高效的 &lt;a href=&#34;https://kafka.apache.org/&#34;&gt;Kafaka&lt;/a&gt; 等等，不过自从我把编程语言切换到 Golang 以后，总觉得必须找个用 Golang 开发的消息系统才配得上门当户对，原本我已经和小家碧玉的 &lt;a href=&#34;https://nsq.io/&#34;&gt;NSQ&lt;/a&gt; 厮守终生，不过当我认识了上流社会 &lt;a href=&#34;https://landscape.cncf.io/&#34;&gt;CNCF&lt;/a&gt; 钦定的大家闺秀 &lt;a href=&#34;https://nats.io/&#34;&gt;NATS&lt;/a&gt; 后，刹那间就仿佛徐志摩遇到了林徽因，扭头就给结发妻子写了休书。&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>浅谈微服务</title>
      <link>https://high-server.github.io/post/arch/microservice/</link>
      <pubDate>Tue, 18 May 2021 10:17:01 +0800</pubDate>
      
      <guid>https://high-server.github.io/post/arch/microservice/</guid>
      <description>&lt;p&gt;虽说&lt;a href=&#34;https://martinfowler.com/articles/microservices.html&#34;&gt;微服务&lt;/a&gt;是一个老生常谈的话题，在 &lt;a href=&#34;https://www.infoq.cn/topic/microservice&#34;&gt;infoq&lt;/a&gt; 或者 &lt;a href=&#34;https://insights.thoughtworks.cn/tag/microservices/&#34;&gt;thoughtworks&lt;/a&gt; 上可以找到很多案例，不过可惜的是其中相当比例的案例是失败的案例，究其原因，除了&lt;a href=&#34;https://microservices.io/index.html&#34;&gt;技术门槛&lt;/a&gt;之外，主要是因为很多人脱离了实际情况，只是为了微服务而微服务。本文通过一个例子带领大家从头到尾体验一下微服务的演化过程，不仅要做到知其然，更要做到知其所以然。&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>关于我们</title>
      <link>https://high-server.github.io/post/about/</link>
      <pubDate>Mon, 10 May 2021 19:59:02 +0800</pubDate>
      
      <guid>https://high-server.github.io/post/about/</guid>
      <description>&lt;p&gt;大家好，我们是搜狗商业技术团队！&lt;/p&gt;</description>
    </item>
    
  </channel>
</rss>
